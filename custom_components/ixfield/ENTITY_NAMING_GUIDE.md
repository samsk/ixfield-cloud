# IXField Entity Naming Guide

This document explains the correct way to name entities and provide friendly names in the IXField Home Assistant integration, following the new Home Assistant entity naming conventions.

## Overview

Home Assistant has introduced new entity naming conventions that require:
- `has_entity_name = True` (mandatory for new integrations)
- Entity names should only identify the data point, not include device name
- Friendly names are automatically generated by combining entity name with device name

## New Naming Convention

### Entity Name Property

The entity's `name` property should only identify the data point represented by the entity, and should **NOT** include the name of the device or the type of the entity.

**Correct Examples:**
- Temperature sensor: `"Temperature"` (not `"Pool Temperature"`)
- pH sensor: `"pH"` (not `"Pool pH"`)
- Pump switch: `"Pump"` (not `"Pool Pump"`)

### Friendly Name Generation

Home Assistant automatically generates the `friendly_name` state attribute by combining the entity name with the device name:

1. **Entity is not a member of a device**: `friendly_name = entity.name`
2. **Entity is a member of a device and entity.name is not None**: `friendly_name = f"{device.name} {entity.name}"`
3. **Entity is a member of a device and entity.name is None**: `friendly_name = f"{device.name}"`

**Examples:**
- Device: "Backyard Pool", Entity: "Temperature" → Friendly Name: "Backyard Pool Temperature"
- Device: "Garden System", Entity: "pH" → Friendly Name: "Garden System pH"
- Device: "Pool Controller", Entity: "Pump" → Friendly Name: "Pool Controller Pump"

## Implementation in IXField Integration

### Entity Class Structure

All IXField entities now follow this pattern:

```python
class IxfieldSensor(CoordinatorEntity, SensorEntity, EntityNamingMixin, EntityCommonAttrsMixin, EntityValueMixin):
    def __init__(self, coordinator, device_id, device_name, value, meta, is_target=False):
        # Set has_entity_name to True for new naming convention
        self._attr_has_entity_name = True
        
        # Store the human-readable name for the name property
        self._sensor_display_name = meta["name"]
        
        # ... rest of initialization ...

    @property
    def name(self) -> str | None:
        """Return the name of the entity."""
        # Return only the data point name, not the device name
        # Home Assistant will automatically combine this with device name for friendly_name
        return self._sensor_display_name
```

### Key Changes Made

1. **Set `has_entity_name = True`**: This tells Home Assistant to use the new naming convention
2. **Implement `name` property**: Returns only the data point name (e.g., "Temperature", "pH")
3. **Remove device prefix from entity name**: No longer include device name in the entity name
4. **Store display name**: Keep the human-readable name for the `name` property

### Updated Entity Classes

The following entity classes have been updated to follow the new convention:

- `IxfieldSensor` (sensor.py)
- `DeviceInfoSensor` (device_info_sensor.py)
- `IxfieldSelect` (select.py)
- `IxfieldNumber` (number.py)
- `IxfieldSwitch` (switch.py)
- `IxfieldClimate` (climate.py)

## Name Generation

### Sensor Names

Sensor names are generated using the `generate_human_readable_name()` function:

```python
def generate_human_readable_name(sensor_name):
    """Generate a human readable name from sensor name."""
    # Remove common suffixes
    name = sensor_name.replace("WithSettings", "")
    name = name.replace("target", "")
    
    # Convert camelCase to spaces
    import re
    name = re.sub(r'([a-z])([A-Z])', r'\1 \2', name)
    
    # Capitalize first letter of each word
    name = name.title()
    
    return name
```

**Examples:**
- `temperatureWithSettings` → `"Temperature"`
- `phValue` → `"Ph Value"`
- `pumpState` → `"Pump State"`

### Configuration Overrides

Sensor names can be overridden using the `sensor_config.py` file:

```python
SENSOR_OVERRIDES = {
    "temperatureWithSettings": {
        "name": "Water Temperature"
    },
    "phValue": {
        "name": "pH Level"
    }
}
```

## Benefits of New Convention

1. **Consistent naming**: All entities follow the same naming pattern
2. **Automatic friendly names**: Home Assistant handles friendly name generation
3. **Better device grouping**: Entities are properly grouped under their devices
4. **Future-proof**: Follows Home Assistant's latest standards
5. **Cleaner entity IDs**: Entity IDs are more readable and consistent

## Migration Notes

### From Old Convention

The old convention used `setup_entity_naming()` which created entity names with device prefixes. This has been deprecated in favor of the new approach.

**Old approach (deprecated):**
```python
self.setup_entity_naming(device_name, sensor_name, "sensor", friendly_name)
```

**New approach:**
```python
self._attr_has_entity_name = True
self._sensor_display_name = friendly_name

@property
def name(self) -> str | None:
    return self._sensor_display_name
```

### Backward Compatibility

The `EntityNamingMixin` class has been updated to mark the old approach as deprecated, but it still works for existing code. New entities should use the new convention.

## Examples

### Temperature Sensor

**Device**: "Backyard Pool"
**Entity Name**: "Temperature"
**Friendly Name**: "Backyard Pool Temperature"
**Entity ID**: `sensor.backyard_pool_temperature`

### pH Sensor

**Device**: "Garden System"
**Entity Name**: "pH"
**Friendly Name**: "Garden System pH"
**Entity ID**: `sensor.garden_system_ph`

### Pump Switch

**Device**: "Pool Controller"
**Entity Name**: "Pump"
**Friendly Name**: "Pool Controller Pump"
**Entity ID**: `switch.pool_controller_pump`

## Best Practices

1. **Use descriptive names**: Entity names should clearly identify what they represent
2. **Keep names short**: Avoid overly long entity names
3. **Use proper capitalization**: Start with capital letter, rest lowercase (unless proper noun)
4. **Be consistent**: Use similar naming patterns for similar types of sensors
5. **Use overrides when needed**: Override names in configuration when the generated name isn't clear enough

## Configuration

To customize entity names, use the sensor configuration overrides in `sensor_config.py`:

```python
SENSOR_OVERRIDES = {
    "temperatureWithSettings": {
        "name": "Water Temperature",
        "unit": "°C"
    },
    "phValue": {
        "name": "pH Level",
        "unit": "pH"
    }
}
```

This approach ensures that your IXField integration follows Home Assistant's latest entity naming standards while providing clear, user-friendly names for all entities. 